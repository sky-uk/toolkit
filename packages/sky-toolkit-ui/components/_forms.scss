/* ==========================================================================
   COMPONENTS / #FORMS
   ========================================================================== */

// Imports
@import "sky-toolkit-core/tools";

// Settings
$form-shadow: 0 0 0 0 rgba(0, 0, 0, 0.2);
$form-shadow-focus: 0 0 8px 0 rgba(0, 0, 0, 0.2);
$form-shadow-error: 0 0 8px 0 rgba(color(error), 0.75);
$form-background: color(white);
$form-border-width: $global-border-width;
$form-border: $form-border-width solid color(grey-20);
$form-font-size: text-body;
$form-icon-size: $global-spacing-unit;
$form-icon-offset: $global-spacing-unit-large;
$form-checkbox-size: 1em;
$form-checkbox-margin: $form-checkbox-size;
$form-checkbox-y-offset: 3px;
$form-animation-speed: $global-animation-speed-fast;
$form-spacing: $global-spacing-unit-small - $form-border-width;

// Tools
// Note: This is not intended for use outside of Forms; it is purely to improve
//       design consistency of inputs and avoid repetition of code.
@mixin _form-spacing() {
  @include height-sizing();
  padding-left: $form-spacing;
  padding-right: $form-spacing;
}

/* Base
  ============================================ */

/* Form List
  ---------------------------------- */

/**
 * All form fields should be presented in a list so that
 *
 *   a) they are easier to navigate using a screenreader;
 *   b) if CSS fails to load for any reason, the user is still presented with a
 *      well-formatted list of fields.
 */
.c-form-list {
  margin: 0;
  padding: 0;
  list-style: none;
}

.c-form-list__item {
  display: block;
  margin-bottom: $global-spacing-unit-small;
  width: 100%;

  @include mq($from: medium) {
    width: 16em;
  }
}

/* For any inputs that need to be displayed full-width */
.c-form-list__item--full {
  @include mq($from: medium) {
    width: 100%;
  }
}

/* Form Pair
  ---------------------------------- */

/**
 * Inline pairs of form labels and inputs should be wrapped in a form-pair.
 */
.c-form-pair {
  margin-bottom: $global-spacing-unit-small;

  @include mq($from: medium) {
    display: table;

    .c-form-pair__label,
    .c-form-pair__input {
      display: table-cell;
      vertical-align: top;
    }

    .c-form-pair__label {
      margin-right: $global-spacing-unit-small;
    }
  }
}

/* Form Labels
  ---------------------------------- */

/**
 * All LABEL elements must also carry a class of `.c-form-label`. By applying
 * these styles to a class and not to the LABEL element directly, we are free
 * to reuse the same look-and-feel on spoofed LABEL elements. E.g. when we have
 * a ‘meta label’ covering a number of sub labels:
 *
 *   Gender
 *   • Male  • Female  • Rather not say
 *
 */
.c-form-label {
  @include font($form-font-size, large);
  display: inline-block;
  margin-bottom: $global-spacing-unit-tiny;
}

/* Form Text Inputs
  ---------------------------------- */

/**
 * All text-like form inputs require a class of `.c-form-input`: we do not use
 * selectors like `input[type="text"] {}`.
 *
 * 1. Fix for IE 10/11 removing vertical padding from inputs which was being ignored.
 * 2. Padding added via line-height/height to re-center text for all browsers (38px to account for border).
 */
.c-form-input {
  @include font($form-font-size, large);
  @include _form-spacing();
  display: inline-block;
  margin-bottom: $global-spacing-unit-small;
  width: 100%;
  background-color: $form-background;
  border: $form-border;
  border-radius: $global-border-radius;
  box-shadow: $form-shadow;
  transition: box-shadow $form-animation-speed ease, border-color $form-animation-speed ease;
  outline: 0;
  -webkit-appearance: none;

  &:focus {
    border-color: $form-background;
    box-shadow: $form-shadow-focus;
    outline: none;
  }

}

/**
 * For use on large text inputs such as textareas
 *
 * 1. As we no longer need to center our text, we can reset the line-height and
 *    use standard box-model padding.
 */
.c-form-input--long {
  height: 6em;
  padding: $global-spacing-unit-small; /* [1] */
  line-height: $global-line-height / $global-font-size; /* [1] */
}

/* Form Date Inputs
  ---------------------------------- */

/**
 * All date-like form inputs require a class of `.c-form-date`: we do not use
 * selectors like `input[type="date"] {}`.
 * Please note the date input is only supported on Edge, Chrome, Opera,
 * iOS Safari and Android. Other browsers will fallback to a text field.
 */
.c-form-date {
  @include font($form-font-size, large);
  @include _form-spacing();
  display: inline-block;
  margin-bottom: $global-spacing-unit-small;
  width: 100%;
  background-color: $form-background;
  border: $form-border;
  border-radius: $global-border-radius;
  box-shadow: $form-shadow;
  transition: box-shadow $form-animation-speed ease, border-color $form-animation-speed ease;
  outline: 0;

  /**
   * 1. Padding between forward slashes in the date format
   */
  &::-webkit-datetime-edit-month-field {
    padding: 2px; /* 1 */
  }

  &::-webkit-datetime-edit-day-field {
    padding-right: 2px; /* 1 */
  }

  &::-webkit-datetime-edit-year-field {
    padding-left: 2px; /* 1 */
  }

  &:focus {
    border-color: $form-background;
    box-shadow: $form-shadow-focus;
  }
}

/* Combination Inputs
  ---------------------------------- */

/**
 * Text and button combo pairs
 */

.c-form-combo {
  display: table;
  width: 100%;
}

.c-form-combo__cell {
  display: table-cell;
  width: 100%;
  vertical-align: top;
}

/**
 * Flatten out the borders between button and input field
 */
.c-form-combo__input {
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
  border-right: 0;
}

/*
 * 1. Brings combo button height in line with input height (38px to account for 2px border).
 */

.c-form-combo__btn {
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
  white-space: nowrap;
}

/**
 * Normalise height-affecting properties across both button and input
 * to insure consistent height
 */
.c-form-combo__btn,
.c-form-combo__input {
  @include font($form-font-size, large);
}

/* Form Select Inputs
  ---------------------------------- */

.c-form-select {
  @include font($form-font-size, large);
  display: inline-block;
  margin-bottom: $global-spacing-unit-small;
  background-color: $form-background;
  border-radius: $global-border-radius;
  position: relative;
  width: 100%;
  cursor: pointer;

  /**
   * Gradient to hide the overflow of long labels
   *
   * 1. Hidden by default, shown on browsers that support pointer-events using feature detection
   * 2. Stretch to full height on the right (taking into account border width)
   * 3. The gradient always starts before the select icon appears.
   */
  &::before {
    display: none; /* [1] */
    content: "";
    position: absolute;
    top: $global-border-width; /* [2] */
    right: $form-border-width; /* [2] */
    bottom: $form-border-width; /* [2] */
    width: $form-icon-offset + $form-icon-size; /* [3] */
    background: $form-background;
    background: -ms-linear-gradient(right, rgba($form-background, 1) 60%, rgba($form-background, 0));
    background: linear-gradient(to left, rgba($form-background, 1) 60%, rgba($form-background, 0));
    border-radius: 0 $global-border-radius $global-border-radius 0;
  }

  /**
   * Custom dropdown indicator icon
   */
  &::after {
    /*! autoprefixer: off */
    content: "";
    position: absolute;
    z-index: z-index(0);
    top: 50%;
    -ms-transform: translateY(-50%);
    transform: translateY(-50%);
    right: $global-spacing-unit-small;
    width: $form-icon-size;
    height: $form-icon-size;
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAkCAYAAAA5DDySAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAPVJREFUeNrk2s0NgzAMhmFno47EKGzQETpSR2CEjkCjyEg0aiAhP7Y/IuUSuLyPhDg4RLycc5PfH78fBLy48/3TyYcrb1iEv53RISxCqpM4dkVGSMSHTakHKAhH8RvAExXhLD58AvziCw0hJz7+E8AgFMcjIVyOR0CojreM0CzeIkLzeEsI3eItIHSP14wwLF4jwvB4TQhi8RoQxOMlEdTESyCoix+JoDZ+BIL6+J4IZuJ7IJiLb4lgNr4Fgvn4GgSY+CsIcPGFCDP0bCIDAXowU4OANZ8sRMCcUGciYN9ROEGAv6BxhHCP+B3CvLubsEjFfwUYAKjtGJxFvDJsAAAAAElFTkSuQmCC");
    background-repeat: no-repeat;
    background-size: contain;
    background-position: center center;
  }
}

.c-form-select__dropdown {
  @include height-sizing(padding);
  position: relative;
  z-index: z-index(1);
  padding-right: $form-icon-offset;
  padding-left: $global-spacing-unit-small;
  width: 100%;
  border: $form-border;
  border-radius: $global-border-radius;
  background-color: transparent;
  box-shadow: $form-shadow;
  transition: box-shadow $form-animation-speed ease, border-color $form-animation-speed ease;
  outline: 0;
  cursor: pointer;
  -webkit-appearance: none;
  -moz-appearance: none;

  &::-ms-expand {
    display: none;
  }
}

.c-form-select__dropdown:focus {
  border-color: $form-background;
  box-shadow: $form-shadow-focus;
}

/**
 * Displays the fade out gradient from .c-form-select::before above the <select>
 * input on browsers that support pointer-events (and feature detection).
 * This prevents the gradient from blocking clicks on browsers that don't support
 * pointer-events. (IE)
 */
@supports (pointer-events:none) {
  .c-form-select {
    &::before,
    &::after {
      display: block;
      z-index: z-index(1);
      pointer-events: none;
    }
  }

  .c-form-select__dropdown {
    z-index: z-index(0);
  }
}

/* Form Checkbox & Radio Inputs
  ---------------------------------- */

.c-form-checkbox {
  display: inline-block;
  width: 100%;
  margin-bottom: $global-spacing-unit-small;
  font-size: font-size($form-font-size, large);
  cursor: pointer;
}

/**
 * For cases where checkboxes or radio buttons need to display inline.
 */
.c-form-checkbox--inline {
  width: auto;
  margin-right: $global-spacing-unit-large;
}

/**
 * Hide the default input visually to utilise keyboard functionality and allow
 * for custom input styles.
 */
.c-form-checkbox__input {
  @include hide-visually();
}

.c-form-checkbox__caption {
  display: block;
  position: relative;
  margin-left: $form-checkbox-size + $form-checkbox-margin;
}

.c-form-checkbox__caption::before {
  content: "";
  display: inline-block;
  position: relative;
  top: $form-checkbox-y-offset;
  margin-left: -($form-checkbox-size + $form-checkbox-margin);
  margin-right: $form-checkbox-margin;
  width: $form-checkbox-size;
  height: $form-checkbox-size;
  background-color: $form-background;
  border: $form-border;
  transition: border-color $form-animation-speed ease;
}

.c-form-checkbox--radio .c-form-checkbox__caption::before {
  border-radius: 100%;
}

.c-form-checkbox__input:focus + .c-form-checkbox__caption::before {
  @include focus-styles();
}

.c-form-checkbox__input:checked + .c-form-checkbox__caption::before {
  background-color: color(brand);
  border-color: color(brand);
  transition: border-color $form-animation-speed ease, background-color $form-animation-speed ease;
}

.c-form-checkbox__input:checked + .c-form-checkbox__caption::after {
  content: "";
  position: absolute;
  top: $form-checkbox-y-offset + $form-border-width;
  left: 0;
  margin-left: -($form-checkbox-size + $form-checkbox-margin);
  width: $form-checkbox-size;
  height: $form-checkbox-size;
  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAuCAYAAACYlx/0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQNJREFUeNrsmO0NgyAURRnBETpCR+kIbNQRHMERHKEjOEJHoGA0MaQJ+AWP++5L+GUCnmOExzVGWTnnej8GPzqjFH6tjyoJEfxao2b4uVTDwwtIwYfnhCc84QlPeMITnvCEJzzhCU941fAhHvLjpRX+sWRkoaxG+G80sVXzz2++vJMioeiGl1jIQsMvC05SJFQ56vykzz97QHEJVc/52hJENDm1JIjq8EpLENnelpIgure/W0ITF5u7JDR1q7taQpNX2qskNH2fPysBIsw4KgEqydkrATLGypUAneFlSsAOME9IwElvD0jAi653SIDO7VMScOEzJODDRxLGDfxb+jv/BBgAG1C+DbIBN9MAAAAASUVORK5CYII=");
  background-repeat: no-repeat;
  background-size: contain;
  background-position: center center;
  border: solid $form-border-width*2 transparent;

  .c-form-checkbox--radio & {
    background-image: none;
  }
}

/* Required Form Inputs
  ---------------------------------- */

/**
 * All required fields must have a styled piece of text present in their LABEL
 * element indicating that they are mandatory, e.g.:
 *
 *   <label for="f-name">
 *     Full name
 *     <abbr title="Required field" class="c-form-required">*</abbr>
 *   </label>
 *
 * 1. Double up the selector’s specificity in order to override some hangover
 *    from Normalize.css.
 *
 */
.c-form-required {
  color: color(error);

  &#{&} { /* [1] */
    border-bottom: none;
    text-decoration: none;
  }
}

/* States
  =========================================== */

/**
 * Errors are handled by adding the .is-error class to the field's parent –
 * usually the .c-form-list__item.
 */
.is-error {
  color: color(error);
}

/**
 * Change form field styles
 */
.c-form-date,
.c-form-input,
.c-form-select__dropdown {
  .is-error &,
  &.is-error,
  &:invalid {
    border-color: color(error);

    &:focus {
      border-color: $form-background;
      box-shadow: $form-shadow-error;
    }
  }
}

/**
 * Change checkbox/radio indicator border color
 */
.c-form-checkbox__caption {
  .is-error &,
  &.is-error,
  &:invalid {
    &::before {
      border-color: color(error);
    }
  }
}
